<% content_for :title, "#{@club.name} - Race Official Controls" %>

<%= turbo_stream_from "club_#{@club.slug}_admin" %>

<div class="space-y-6" data-controller="counter">
  <!-- Header -->
  <div class="text-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800 mb-1"><%= @club.name %></h1>
    <p class="text-gray-600 font-semibold">Race Official Controls</p>
    <%= link_to "← Public Display", club_race_path(@club.slug), 
                class: "inline-block mt-2 text-blue-600 underline" %>
  </div>

  <!-- Validation Messages -->
  <div id="validation-message">
    <% if @race.at_gate > @race.in_staging %>
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        ⚠️ At Gate cannot be greater than In Staging
      </div>
    <% end %>
  </div>

  <!-- Admin Counters (updates via Turbo Stream) -->
  <div id="admin-counters">
    <%= render "admin_counters", race: @race, club: @club %>
  </div>

  <!-- Reset Section -->
  <div class="bg-gray-100 border border-gray-300 rounded-lg p-4 text-center">
    <h3 class="font-semibold text-gray-800 mb-3">⚠️ Reset Race</h3>
    <%= form_with model: @race, url: club_race_update_path(@club.slug), 
                  method: :patch, local: false,
                  data: { turbo_method: :patch, 
                          confirm: "Are you sure you want to reset both counters to 0? This cannot be undone." } do |form| %>
      <%= form.hidden_field :at_gate, value: 0 %>
      <%= form.hidden_field :in_staging, value: 0 %>
      <%= form.submit "Reset All", 
                      data: { counter_target: "submitButton" },
                      style: "background-color: #dc3545; 
                              color: white; 
                              font-size: 18px; 
                              font-weight: bold;
                              min-height: 44px; 
                              min-width: 120px; 
                              padding: 12px 24px;
                              border: none; 
                              border-radius: 8px; 
                              touch-action: manipulation;
                              cursor: pointer;" %>
    <% end %>
  </div>
</div>

